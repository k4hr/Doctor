// prisma/schema.prisma
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum DoctorStatus {
  DRAFT       // анкета сохранена, но НЕ отправлена на модерацию
  PENDING     // отправлено на модерацию
  NEED_FIX    // модератор запросил правки
  APPROVED    // одобрен
  REJECTED    // отклонён окончательно
}

enum DoctorFileKind {
  PROFILE_PHOTO   // фото профиля (до 3)
  DIPLOMA_PHOTO   // диплом/доки (до 10)
  // на будущее можно добавить:
  // CERTIFICATE
  // LICENSE
}

model Doctor {
  // --------------------
  // Системные поля
  // --------------------
  id          String       @id @default(cuid())
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  submittedAt DateTime?    // выставляем при первой отправке на модерацию
  status      DoctorStatus @default(DRAFT)

  // --------------------
  // Telegram
  // --------------------
  telegramId        String  @unique
  telegramUsername  String?
  telegramFirstName String?
  telegramLastName  String?

  // --------------------
  // Личные данные
  // --------------------
  lastName   String
  firstName  String
  middleName String?
  gender     String        // male / female
  birthDay   Int?
  birthMonth Int?
  birthYear  Int?
  city       String?

  // --------------------
  // Профессиональные данные
  // --------------------
  speciality1     String
  speciality2     String?
  speciality3     String?
  education       String
  degree          String?   // none / specialist / candidate / doctor
  workplace       String?
  position        String?
  experienceYears Int
  awards          String?

  // --------------------
  // Контакты
  // --------------------
  email String

  // --------------------
  // Описание профиля
  // --------------------
  about             String
  specialityDetails String
  experienceDetails String
  courses           String?
  achievements      String?
  publications      String?

  // --------------------
  // Документы/файлы
  // --------------------
  files DoctorFile[]

  // --------------------
  // Индексы
  // --------------------
  @@index([status])
  @@index([speciality1])
  @@index([city])
  @@index([submittedAt])
}

model DoctorFile {
  id        String         @id @default(cuid())
  createdAt DateTime       @default(now())

  doctorId  String
  doctor    Doctor         @relation(fields: [doctorId], references: [id], onDelete: Cascade)

  kind      DoctorFileKind
  url       String         // сюда кладём public url или key (если public base не задан)
  mime      String?
  sizeBytes Int?

  // порядок отображения (если нужно)
  sortOrder Int            @default(0)

  @@index([doctorId])
  @@index([kind])
  @@index([doctorId, kind])
}
